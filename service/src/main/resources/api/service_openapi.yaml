# DEVELOPER NOTES
#
# There are three sections of the file bracketed with ## ## that are deprecated. They are the
# data references interface that we abandoned in favor of the unified resources interface.
#
# CLOUD RESOURCE STRUCTURE
# Each cloud resource has a structure named '{cloud}{resource-type}Resource';
# for example, GcpGcsBucketResource. It has two properties: 'metadata' and 'attributes'
#
# The 'metadata' property is a reference to the common metadata structure for all resource types:
#  $ref: '#/components/schemas/ResourceMetadata'
# Metadata includes both the common data for all resources and an optional structure for
# properties of controlled resources.
#
# The 'attributes' property is a reference to a unique structure named '{resource-type}Attributes';
# for example, GcpGcsBucketAttributes. Attributes are specific to the cloud resource so may
# be a complex structure.
#
# The resource structure should be used as the common form of return in the CRUD operations on
# the object. Well, the CRU ones anyway...
#
# ENUMERATION STRUCTURE
# Resource enumeration returns ResourceList - a list of ResourceDescription. Each description
# provides the common metadata, as described above and then a union structure with an entry
# for the metadata for each cloud resource type. It is a bit clumsy, but provides complete
# description for a resource.
#
openapi: 3.0.3
info:
  title: Workspace Manager API
  description: Workspace Manager REST API to manage workspaces.
  version: 0.0.1

paths:
  # Unauthenticated Paths
  /status:
    get:
      security: []
      summary: Returns the operational status of the service
      operationId: serviceStatus
      tags: [Unauthenticated]
      responses:
        '200':
          description: Service can process requests
        '500':
          description: |
            Service cannot process requests. That might be because dependent services are
            unavailable, or because there is a problem with the service itself.
  /version:
    get:
      security: []
      summary: Returns the deployed version of the service
      operationId: serviceVersion
      tags: [Unauthenticated]
      responses:
        '200':
          description: System version response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SystemVersion'

  # Workspace paths
  /api/workspaces/v1:
    post:
      summary: Create a new Workspace.
      operationId: createWorkspace
      tags: [Workspace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateWorkspaceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CreatedWorkspaceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/NotFound'
    get:
      parameters:
      - $ref: '#/components/parameters/Offset'
      - $ref: '#/components/parameters/Limit'
      summary: List all workspaces a user can read.
      operationId: listWorkspaces
      tags: [ Workspace ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceDescriptionList'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    get:
      summary: Get an existing Workspace.
      operationId: getWorkspace
      tags: [Workspace]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceDescription'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update an existing Workspace.
      operationId: updateWorkspace
      tags: [Workspace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkspaceRequestBody'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/WorkspaceDescription'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete a Workspace.
      operationId: deleteWorkspace
      tags: [Workspace]
      responses:
        '204':
          description: Success
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  # TODO(zloery): This endpoint is exposed as a workaround to support the CLI's
  # use of Nextflow. It will likely be removed in the future in favor of other
  # cloud sync methods.
  /api/workspaces/v1/{workspaceId}/gcp/enablepet:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Allow a user to impersonate their pet SA in a given workspace
      description: |
        This endpoint is exposed as a workaround to support calling Google
        Pipelines API in a workspace. It will likely be removed in the future in
        favor of other cloud sync methods.
      operationId: enablePet
      tags: [ Workspace ]
      responses:
        '200':
          $ref: '#/components/responses/EnablePetSaResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Clone a workspace and its eligible resources
      operationId: cloneWorkspace
      tags: [Workspace]
      requestBody:
        description: Details of workspce clone operation
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/parameters/CloneWorkspaceRequest'
      responses:
        '200':
          $ref: '#/components/responses/CloneWorkspaceResponse'
        '202':
          $ref: '#/components/responses/CloneWorkspaceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/clone-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a gcp bucket clone job.
      operationId: getCloneWorkspaceResult
      tags: [Workspace]
      responses:
        '200':
          $ref: '#/components/responses/CloneWorkspaceResponse'
        '202':
          $ref: '#/components/responses/CloneWorkspaceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  ## DEPRECATED PATHS ##
  # TODO(PF-404): remove this in favor of reference-type specific objects.
  /api/workspaces/v1/{workspaceId}/datareferences:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    post:
      deprecated: true
      summary: (DEPRECATED) Create a new data reference in a workspace.
      operationId: createDataReference
      tags: [Workspace]
      requestBody:
        required: true
        description: Stuff TBD
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataReferenceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/DataReferenceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    get:
      deprecated: true
      summary: (DEPRECATED) Enumerate the data references in a workspace.
      operationId: enumerateReferences
      tags: [Workspace]
      parameters:
        - $ref: '#/components/parameters/Offset'
        - $ref: '#/components/parameters/Limit'
      responses:
        '200':
          $ref: '#/components/responses/ReferenceListResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  # TODO(PF-404): remove this in favor of reference-type specific objects.
  /api/workspaces/v1/{workspaceId}/datareferences/{referenceId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ReferenceId'
    get:
      deprecated: true
      summary: (DEPRECATED) Gets a data reference from a workspace.
      operationId: getDataReference
      tags: [Workspace]
      responses:
        '200':
          $ref: '#/components/responses/DataReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      deprecated: true
      summary: (DEPRECATED) Update name or description of a data reference in a workspace.
      operationId: updateDataReference
      tags: [Workspace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDataReferenceRequestBody'
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      deprecated: true
      summary: (DEPRECATED) Deletes a data reference from a workspace.
      operationId: deleteDataReference
      tags: [Workspace]
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  # TODO(PF-404): remove this in favor of reference-type specific objects.
  /api/workspaces/v1/{workspaceId}/datareferences/{referenceType}/{name}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ReferenceType'
      - $ref: '#/components/parameters/Name'
    get:
      deprecated: true
      summary: (DEPRECATED) Gets a data reference from a workspace by name and type.
      operationId: getDataReferenceByName
      tags: [Workspace]
      responses:
        '200':
          $ref: '#/components/responses/DataReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  ## END OF DEPRECATED PATHS ##

  /api/workspaces/v1/{workspaceId}/resources:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/Offset'
      - $ref: '#/components/parameters/Limit'
      - $ref: '#/components/parameters/ResourceType'
      - $ref: '#/components/parameters/StewardshipType'
    get:
      summary: |
        Enumerate resources in a workspace. The visible resources depend on the permissions of the caller.
        These are presented sorted by ascending resource name. The offset and limit parameters allow paging
        through the results. You can also filter by a resource type and by a stewardship type.
      operationId: enumerateResources
      tags: [Resource]
      responses:
        '200':
          $ref: '#/components/responses/EnumerateResourcesResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/{resourceId}/access:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Check a user's access to a referenced resource
      operationId: checkReferenceAccess
      tags: [Resource]
      responses:
        '200':
          $ref: '#/components/responses/CheckReferenceAccessResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/datarepo/snapshots:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new data repo snapshot reference in a workspace.
      operationId: createDataRepoSnapshotReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateDataRepoSnapshotReferenceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/DataRepoSnapshotReferenceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/datarepo/snapshots/{resourceId}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Gets a reference to a snapshot from a workspace.
      operationId: getDataRepoSnapshotReference
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/DataRepoSnapshotReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update name or description of a snapshot reference in a workspace.
      operationId: updateDataRepoSnapshotReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDataReferenceRequestBody'
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete datarepo snapshot reference
      operationId: deleteDataRepoSnapshotReference
      tags: [ReferencedGcpResource]
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/referenced/datarepo/snapshots/{resourceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    post:
      summary: Clone a referenced Data Repo Snapshot resource
      operationId: cloneGcpDataRepoSnapshotReference
      tags: [ ReferencedGcpResource ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneReferencedResourceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CloneReferencedGcpDataRepoSnapshotResourceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/datarepo/snapshots/name/{name}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/Name'
    get:
      summary: Gets a reference to a snapshot by name.
      operationId: getDataRepoSnapshotReferenceByName
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/DataRepoSnapshotReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/buckets:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new GCS bucket reference in a workspace.
      operationId: createBucketReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGcpGcsBucketReferenceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/GcpGcsBucketReferenceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/buckets/{resourceId}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Gets a reference to a bucket from a workspace.
      operationId: getBucketReference
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GcpGcsBucketReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update name or description of a bucket reference in a workspace.
      operationId: updateBucketReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDataReferenceRequestBody'
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete Gcp bucket reference
      operationId: deleteBucketReference
      tags: [ReferencedGcpResource]
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/buckets/{resourceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    post:
      summary: Clone a referenced GCS Bucket resource
      operationId: cloneGcpGcsBucketReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneReferencedResourceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CloneReferencedGcpGcsBucketResourceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/buckets/name/{name}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/Name'
    get:
      summary: Gets a reference to a Gcp bucket by name.
      operationId: getBucketReferenceByName
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GcpGcsBucketReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/bigquerydatasets:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new BigQuery dataset reference in a workspace.
      operationId: createBigQueryDatasetReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGcpBigQueryDatasetReferenceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/GcpBigQueryDatasetReferenceResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/bigquerydatasets/{resourceId}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Gets a reference to a BigQuery dataset from a workspace.
      operationId: getBigQueryDatasetReference
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GcpBigQueryDatasetReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update name or description of a BigQuery dataset reference in a workspace.
      operationId: updateBigQueryDatasetReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateDataReferenceRequestBody'
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete BigQuery dataset reference
      operationId: deleteBigQueryDatasetReference
      tags: [ReferencedGcpResource]
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/bigquerydatasets/{resourceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    post:
      summary: Clone a BigQuery Dataset
      operationId: cloneGcpBigQueryDatasetReference
      tags: [ReferencedGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneReferencedResourceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CloneReferencedGcpBigQueryDatasetResourceResponse'
        '202':
          $ref: '#/components/responses/CloneReferencedGcpBigQueryDatasetResourceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/referenced/gcp/bigquerydatasets/name/{name}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/Name'
    get:
      summary: Gets a reference to a BigQuery dataset by name.
      operationId: getBigQueryDatasetReferenceByName
      tags: [ReferencedGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GcpBigQueryDatasetReferenceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/cloudcontexts:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a cloud context for the workspace.
      operationId: createCloudContext
      tags: [Workspace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCloudContextRequest'
      responses:
        '200':
          $ref: '#/components/responses/CreateCloudContextResultResponse'
        '202':
          $ref: '#/components/responses/CreateCloudContextResultResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/cloudcontexts/result/{jobId}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/JobId'
    get:
      summary: Get the result of a async job to create a cloud context.
      operationId: getCreateCloudContextResult
      tags: [Workspace]
      responses:
        '200':
          $ref: '#/components/responses/CreateCloudContextResultResponse'
        '202':
          $ref: '#/components/responses/CreateCloudContextResultResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          $ref: '#/components/responses/Conflict'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/cloudcontexts/{cloudContext}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/CloudContext'
    delete:
      summary: Deletes a cloud context and all of its data from a workspace.
      operationId: deleteCloudContext
      tags: [Workspace]
      responses:
        '204':
          description: OK
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/roles:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    get:
      summary: Read all IAM roles and their members in a workspace.
      operationId: getRoles
      tags: [Workspace]
      responses:
        '200':
          $ref: '#/components/responses/RoleBindingListResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/roles/{role}/members:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/Role'
    post:
      summary: Grant an IAM role to a user or group.
      operationId: grantRole
      tags: [Workspace]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/GrantRoleRequestBody'
      responses:
        '204':
          description: Role granted successfully
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/roles/{role}/members/{memberEmail}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/Role'
    - $ref: '#/components/parameters/MemberEmail'
    delete:
      summary: Remove an IAM role from a user or group.
      operationId: removeRole
      tags: [Workspace]
      responses:
        '204':
          description: Role removed successfully
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'


  /api/job/v1/jobs/{jobId}:
    parameters:
    - $ref: '#/components/parameters/JobId'
    get:
      tags:
      - jobs
      operationId: retrieveJob
      responses:
        200:
          description: Job is complete (succeeded or failed)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobReport'
        202:
          description: Job is running
          headers:
            Retry-After:
              description: >-
                optional - estimated seconds to wait before polling again. This allows
                a server to offer a hint as to when the job might be complete.
              schema:
                type: integer
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/JobReport'
        400:
          $ref: '#/components/responses/BadRequest'
        403:
          $ref: '#/components/responses/PermissionDenied'
        404:
          $ref: '#/components/responses/NotFound'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/buckets:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new controlled Gcp bucket
      operationId: createBucket
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateControlledGcpGcsBucketRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CreatedControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/buckets/{resourceId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Get a controlled GCS bucket resource
      operationId: getBucket
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GetControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update a controlled GCS Bucket resource.
      operationId: updateGcsBucket
      tags: [ ControlledGcpResource ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateControlledGcpGcsBucketRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/UpdateControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      summary: |
        Delete a controlled GCS bucket resource. This is async, because deleting the bucket and contents can
        take a very long time. NOTE: this cannot be an HTTP DELETE, because something between generated code
        and server behavior does not support delete operations with bodies. We require the body for the async
        state, so this is a POST.
      operationId: deleteBucket
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteControlledGcpGcsBucketRequest'
      responses:
        '200':
          $ref: '#/components/responses/DeleteControlledGcpGcsBucketResponse'
        '202':
          $ref: '#/components/responses/DeleteControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/buckets/{resourceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    post:
      summary: Clone a GCS Bucket
      operationId: cloneGcsBucket
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneControlledGcpGcsBucketRequest'
      responses:
        '200':
          $ref: '#/components/responses/ClonedControlledGcpGcsBucketResponse'
        '202':
          $ref: '#/components/responses/ClonedControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/buckets/clone-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a gcp bucket clone job.
      operationId: getCloneGcsBucketResult
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/ClonedControlledGcpGcsBucketResponse'
        '202':
          $ref: '#/components/responses/ClonedControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/buckets/delete-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a gcp bucket deletion job.
      operationId: getDeleteBucketResult
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/DeleteControlledGcpGcsBucketResponse'
        '202':
          $ref: '#/components/responses/DeleteControlledGcpGcsBucketResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/bqdatasets:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new controlled BigQuery dataset
      operationId: createBigQueryDataset
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateControlledGcpBigQueryDatasetRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CreatedControlledGcpBigQueryDatasetResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/bqdatasets/{resourceId}:
    parameters:
    - $ref: '#/components/parameters/WorkspaceId'
    - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Get a controlled BigQuery dataset resource
      operationId: getBigQueryDataset
      tags: [ ControlledGcpResource ]
      responses:
        '200':
          $ref: '#/components/responses/ControlledGcpBigQueryDatasetResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    patch:
      summary: Update a controlled BigQuery dataset resource
      operationId: updateBigQueryDataset
      tags: [ ControlledGcpResource ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateControlledGcpBigQueryDatasetRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/ControlledGcpBigQueryDatasetResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    delete:
      summary: Delete a controlled Bigquery dataset
      operationId: deleteBigQueryDataset
      tags: [ ControlledGcpResource ]
      responses:
        '204':
          description: Success
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/bqdatasets/{resourceId}/clone:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    post:
      summary: Clone a BigQuery dataset
      operationId: cloneBigQueryDataset
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CloneControlledGcpBigQueryDatasetRequest'
      responses:
        '200':
          $ref: '#/components/responses/CloneControlledGcpBigQueryDatasetResponse'
        '202':
          $ref: '#/components/responses/CloneControlledGcpBigQueryDatasetResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/bqdatasets/clone-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a gcp BigQuery dataset clone job.
      operationId: getCloneBigQueryDatasetResult
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/CloneControlledGcpBigQueryDatasetResponse'
        '202':
          $ref: '#/components/responses/CloneControlledGcpBigQueryDatasetResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/ai-notebook-instances:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
    post:
      summary: Create a new controlled Gcp AI Platform Notebook Instance
      operationId: createAiNotebookInstance
      tags: [ControlledGcpResource]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateControlledGcpAiNotebookInstanceRequestBody'
      responses:
        '200':
          $ref: '#/components/responses/CreatedControlledGcpAiNotebookInstanceResponse'
        '202':
          $ref: '#/components/responses/CreatedControlledGcpAiNotebookInstanceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/ai-notebook-instances/create-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a GCP AI Platform Notebook create instance job.
      operationId: getCreateAiNotebookInstanceResult
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/CreatedControlledGcpAiNotebookInstanceResponse'
        '202':
          $ref: '#/components/responses/CreatedControlledGcpAiNotebookInstanceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/ai-notebook-instances/{resourceId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/ResourceId'
    get:
      summary: Get a controlled AI Notebook instance resource
      operationId: getAiNotebookInstance
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/GetControlledGcpAiNotebookInstanceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'
    post:
      summary: |
        Delete a controlled GCP AI Notebook instance resource. This is async, because deleting the
        notebook instance can take ~5 minutes. NOTE: this cannot be an HTTP DELETE, because
        something between generated code and server behavior does not support delete operations with
        bodies. We require the body for the async state, so this is a POST.
      operationId: deleteAiNotebookInstance
      tags: [ ControlledGcpResource ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/DeleteControlledGcpAiNotebookInstanceRequest'
      responses:
        '200':
          $ref: '#/components/responses/DeleteControlledGcpAiNotebookInstanceResponse'
        '202':
          $ref: '#/components/responses/DeleteControlledGcpAiNotebookInstanceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

  /api/workspaces/v1/{workspaceId}/resources/controlled/gcp/ai-notebook-instances/delete-result/{jobId}:
    parameters:
      - $ref: '#/components/parameters/WorkspaceId'
      - $ref: '#/components/parameters/JobId'
    get:
      summary: Retrieve information about a GCP AI Platform Notebook delete instance job.
      operationId: getDeleteAiNotebookInstanceResult
      tags: [ControlledGcpResource]
      responses:
        '200':
          $ref: '#/components/responses/DeleteControlledGcpAiNotebookInstanceResponse'
        '202':
          $ref: '#/components/responses/DeleteControlledGcpAiNotebookInstanceResponse'
        '403':
          $ref: '#/components/responses/PermissionDenied'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/ServerError'

components:
  parameters:
    ## DEPRECATED PARAMETERS ##
    # TODO(PF-404): remove this in favor of reference-type specific objects.
    ReferenceId:
      name: referenceId
      in: path
      description: (DEPRECATED) A UUID used to identify a data reference in a workspace.
      required: true
      schema:
        type: string
        format: uuid

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    ReferenceType:
      name: referenceType
      in: path
      description: (DEPRECATED) The type of a data reference in a workspace
      required: true
      schema:
        $ref: '#/components/schemas/ReferenceTypeEnum'
    ## END OF DEPRECATED PARAMETERS ##

    WorkspaceId:
      name: workspaceId
      in: path
      description: A UUID to used to identify an object in the workspace manager
      required: true
      schema:
        type: string
        format: uuid

    JobId:
      name: jobId
      in: path
      description: A String ID to used to identify a job
      required: true
      schema:
        type: string

    Offset:
      name: offset
      in: query
      description: The number of items to skip before starting to collect the result set.
      schema:
        type: integer
        minimum: 0
        default: 0

    Limit:
      name: limit
      in: query
      description: The maximum number of items to return. Default 10
      schema:
        type: integer
        minimum: 1
        default: 10

    ResourceId:
      name: resourceId
      in: path
      description: A UUID used to identify a controlled resource in a workspace.
      required: true
      schema:
        type: string
        format: uuid

    ResourceType:
      name: resource
      in: query
      description: Filter on a specific resource type
      required: false
      schema:
        $ref: '#/components/schemas/ResourceType'

    StewardshipType:
      name: stewardship
      in: query
      description: Filter on a stewardship type
      required: false
      schema:
        $ref: '#/components/schemas/StewardshipType'

    Name:
      name: name
      in: path
      description: A name used to identify an object in the workspace manager
      required: true
      schema:
        $ref: '#/components/schemas/Name'

    Role:
      name: role
      in: path
      description: An IAM role
      required: true
      schema:
        $ref: '#/components/schemas/IamRole'

    MemberEmail:
      name: memberEmail
      in: path
      description: A user or group's email. Used for adding or removing IAM permissions
      required: true
      schema:
        type: string

    CloudContext:
      name: cloudContext
      in: path
      description: A cloud platform which holds context for a workspace.
      required: true
      schema:
        $ref: '#/components/schemas/CloudPlatform'

  schemas:
    CloneReferencedResourceRequestBody:
      description: >-
        Cloning options for referenced resources. If optional parameters are omitted,
        the source values will be used.
      type: object
      required: [destinationWorkspaceId]
      properties:
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        destinationWorkspaceId:
          type: string
          format: uuid
        # Null for original name
        name:
          $ref: "#/components/schemas/Name"
        description:
          description: Description for the referenced resource clone, or null to use original.
          type: string

    ### DEPRECATED SCHEMAS ###
    # TODO(PF-404): remove this in favor of reference-type specific objects.
    CreateDataReferenceRequestBody:
      deprecated: true
      type: object
      required: [name, cloningInstructions]
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
          default: ""
        resourceId:
          description: The ID of the resource
          type: string
          format: uuid
        referenceType:
          $ref: '#/components/schemas/ReferenceTypeEnum'
        reference:
          $ref: '#/components/schemas/DataRepoSnapshot'
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataReferenceRequestMetadata:
      deprecated: true
      type: object
      required: [name, cloningInstructions]
      description: (DEPRECATED) Common information shared across all types of data reference requests.
      properties:
        ## TODO: This is not implemented as a name. It used as if it is a snapshot identifier (UUID)
        ##   So either this is a misnomer, or we are doing it wrong.
        name:
          $ref: "#/components/schemas/Name"
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        description:
          type: string
          default: ""

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataReferenceDescription:
      deprecated: true
      type: object
      required: [referenceId, name, description, workspaceId, cloningInstructions]
      properties:
        referenceId:
          description: The ID of the data reference
          type: string
          format: uuid
        name:
          description: The name of the data reference; used to refer to the reference
          type: string
        description:
          type: string
        workspaceId:
          description: The ID of the workspace containing the reference
          type: string
          format: uuid
        resourceDescription:
          $ref: '#/components/schemas/DeprecatedResourceDescription'
        referenceType:
          $ref: '#/components/schemas/ReferenceTypeEnum'
        reference:
          $ref: '#/components/schemas/DataRepoSnapshot'
        credentialId:
          description: The ID of the credential to use when accessing the resource
          type: string
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    ReferenceTypeEnum:
      deprecated: true
      type: string
      description: (DEPRECATED) The type of a reference, if an uncontrolled resource
      # TODO: swagger-codegen always looks for and removes a common prefix for
      # enum values, which breaks enums that only have a single value.
      # PLACEHOLDER_VALUE should be removed when we have an actual second value
      # to use.
      enum: ['DATA_REPO_SNAPSHOT', 'PLACEHOLDER_VALUE'] #eventually include GCS bucket, etc.

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataReferenceList:
      deprecated: true
      type: object
      required: [resources]
      properties:
        resources:
          description: A list of controlled and/or uncontrolled data references
          type: array
          items:
            $ref: '#/components/schemas/DataReferenceDescription'

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    UpdateDataReferenceRequestBody:
      deprecated: true
      type: object
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataReferenceMetadata:
      deprecated: true
      type: object
      required: [referenceId, name, workspaceId, cloningInstructions]
      description: (DEPRECATED) Information common across all types of references.
      properties:
        referenceId:
          description: The ID of the data reference
          type: string
          format: uuid
        name:
          description: The name of the data reference; used to refer to the reference
          type: string
        description:
          type: string
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        workspaceId:
          description: The ID of the workspace containing the reference
          type: string
          format: uuid

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataRepoSnapshotReference:
      deprecated: true
      type: object
      description: (DEPRECATED) A reference to a Data Repo snapshot.
      required: [metadata, snapshot]
      properties:
        metadata:
          $ref: '#/components/schemas/DataReferenceMetadata'
        snapshot:
          $ref: '#/components/schemas/DataRepoSnapshot'

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataRepoSnapshot:
      deprecated: true
      description: (DEPRECATED) A reference to a snapshot in Data Repo.
      type: object
      required: [instanceName, snapshot]
      properties:
        instanceName:
          description: The name of the Data Repo instance
          type: string
        snapshot:
          description: The ID of the Data Repo snapshot
          type: string

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DeprecatedResourceDescription:
      deprecated: true
      description: (DEPRECATED) Description of the workspace resource, if this is a controlled reference.
      type: object
      required: [resourceId, workspaceId, isVisible]
      properties:
        resourceId:
          description: The ID of the resource
          type: string
          format: uuid
        workspaceId:
          description: The ID of the workspace holding the resource
          type: string
          format: uuid
        applicationId:
          description: ID of application this resource is associated with, if any
          type: string
        isVisible:
          description: Whether this resource is visible or not
          type: boolean
        owner:
          description: ID of owner. null for shared resources
          type: string
        attributes:
          description: JSON map of user-provided attributes
          type: string

    ### END OF DEPRECATED SCHEMAS ###

    ErrorReport:
      type: object
      required: [message, statusCode, causes]
      properties:
        message:
          type: string
        statusCode:
          type: integer
        causes:
          type: array
          items:
            type: string

    JobReport:
      type: object
      required: [id, status, statusCode, resultURL]
      properties:
        id:
          description: caller-provided unique identifier for the job
          type: string
        description:
          description: caller-provided description of the job
          type: string
        status:
          description: status of the job
          type: string
          enum: [RUNNING, SUCCEEDED, FAILED]
        statusCode:
          description: HTTP code providing status of the job.
          type: integer
        submitted:
          description: timestamp when the job was submitted; in ISO-8601 format
          type: string
        completed:
          description: >-
            timestamp when the job completed - in ISO-8601 format. Present if
            status is SUCCEEDED or FAILED.
          type: string
        resultURL:
          description: >-
            URL where the result of the job can be retrieved. Equivalent to a
            Location header in HTTP.
          type: string

    JobControl:
      type: object
      required: [id]
      properties:
        id:
          description: >-
            Unique identifier for the job. Best practice is for job identifier to be a UUID,
            a ShortUUID, or other globally unique identifier.
          type: string
        # TODO: In the future, notification configuration will also be part of JobControl.

    Name:
      # Note: These format restrictions are enforced by WM, not natively by
      # Swagger.
      type: string
      pattern: '^[a-zA-Z0-9][_a-zA-Z0-9]{0,62}$'
      minLength: 1
      maxLength: 63

    SystemVersion:
      type: object
      required: [gitTag, gitHash, github, build]
      properties:
        gitTag:
          type: string
          description: Git tag of currently deployed app.
        gitHash:
          type: string
          description: Git hash of currently deployed app.
        github:
          type: string
          description: Github link to currently deployed commit.
        build:
          type: string
          description: Version of the currently deployed app declared in build.gradle. Client and server versions are linked.

    CreateWorkspaceRequestBody:
      type: object
      required: [id]
      properties:
        id:
          description: The ID of the workspace
          type: string
          format: uuid
        displayName:
          description: The human readable name of the workspace
          type: string
        description:
          description: A description of the workspace
          type: string
        spendProfile:
          description: ID of provided spend profile
          type: string
        policies:
          description: Policies provided by the containing folder
          type: array
          items:
            type: string
            format: uuid
        stage:
          $ref: '#/components/schemas/WorkspaceStageModel'

    CreatedWorkspace:
      type: object
      required: [id]
      properties:
        id:
          description: UUID of a newly-created workspace
          type: string
          format: uuid

    WorkspaceDescription:
      type: object
      required: [id]
      properties:
        id:
          description: The ID of the workspace
          type: string
          format: uuid
        displayName:
          description: The human readable name of the workspace
          type: string
        description:
          description: A description of the workspace
          type: string
        spendProfile:
          description: ID of provided spend profile
          type: string
        stage:
          $ref: '#/components/schemas/WorkspaceStageModel'
        gcpContext:
          description: GCP context, if one exists
          $ref: '#/components/schemas/GcpContext'
        # When we have an Azure context, we can put it right here.
        # No point making a complex structure when there will be only a few of these

    UpdateWorkspaceRequestBody:
      type: object
      properties:
        displayName:
          description: The human readable name of the workspace
          type: string
        description:
          description: A description of the workspace
          type: string

    WorkspaceDescriptionList:
      type: object
      required: [ workspaces ]
      properties:
        workspaces:
          description: A list of workspaces
          type: array
          items:
            $ref: '#/components/schemas/WorkspaceDescription'

    CreateCloudContextRequest:
      type: object
      required: [cloudPlatform, jobControl]
      description: |
        Request body for asynchronously creating a cloud context for a workspace.
        Contains the CloudPlatform for the context and the JobControl object.
      properties:
        cloudPlatform:
          $ref: '#/components/schemas/CloudPlatform'
        jobControl:
          $ref: '#/components/schemas/JobControl'

    GcpContext:
      type: object
      description: The GCP cloud context associated with a workspace.
      properties:
        projectId:
          description: The ID of Gcp Project associated with the workspace.
          type: string

    CreateCloudContextResult:
      type: object
      description: |
        The result of a call to create a cloud context for a workspace. Contains
        a JobReport detailing the async operation and either a GcpContext
        or an ErrorReport detailing an error.
      required: [jobReport]
      properties:
        jobReport:
          $ref: '#/components/schemas/JobReport'
        gcpContext:
          $ref: '#/components/schemas/GcpContext'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'

    CreateDataRepoSnapshotReferenceRequestBody:
      type: object
      description: A request to create a reference to a Data Repo snapshot.
      required: [metadata, snapshot]
      properties:
        metadata:
          $ref: '#/components/schemas/ReferenceResourceCommonFields'
        snapshot:
          $ref: '#/components/schemas/DataRepoSnapshotAttributes'

    CreateGcpGcsBucketReferenceRequestBody:
      type: object
      description: A request to create a reference to a GCS bucket.
      required: [metadata, bucket]
      properties:
        metadata:
          $ref: '#/components/schemas/ReferenceResourceCommonFields'
        bucket:
          $ref: '#/components/schemas/GcpGcsBucketAttributes'

    CreateGcpBigQueryDatasetReferenceRequestBody:
      type: object
      description: A request to create a reference to a BigQuery dataset.
      required: [metadata, dataset]
      properties:
        metadata:
          $ref: '#/components/schemas/ReferenceResourceCommonFields'
        dataset:
          $ref: '#/components/schemas/GcpBigQueryDatasetAttributes'

    WorkspaceStageModel:
      description: Enum for possible stages of a workspace along the Rawls migration path
      type: string
      enum: ['RAWLS_WORKSPACE', 'MC_WORKSPACE']

    IamRole:
      description: Enum containing all valid IAM roles on a Workspace
      type: string
      enum: ['READER', 'WRITER', 'APPLICATION', 'OWNER']

    ControlledResourceIamRole:
      description: Enum containing all IAM roles on controlled resources available to users
      type: string
      enum: [ 'READER', 'WRITER', 'EDITOR']

    RoleBinding:
      description: A binding between an IAM role and users with that role
      type: object
      required: [role]
      properties:
        role:
          $ref: '#/components/schemas/IamRole'
        members:
          description: A list of users that this role applies to
          type: array
          items:
            type: string

    RoleBindingList:
      description: A list of role bindings
      type: array
      items:
        $ref: '#/components/schemas/RoleBinding'

    GrantRoleRequestBody:
      description: The body for a request to grant a role to a single user.
      type: object
      required: [memberEmail]
      properties:
        memberEmail:
          type: string

    CreateControlledGcpGcsBucketRequestBody:
      description: Payload for requesting a new controlled GCS bucket resource.
      type: object
      properties:
        common:
          $ref: '#/components/schemas/ControlledResourceCommonFields'
        gcsBucket:
          $ref: '#/components/schemas/GcpGcsBucketCreationParameters'

    CreateControlledGcpBigQueryDatasetRequestBody:
      description: Payload for requesting a new controlled BigQuery dataset resource.
      type: object
      properties:
        common:
          $ref: '#/components/schemas/ControlledResourceCommonFields'
        dataset:
          $ref: '#/components/schemas/GcpBigQueryDatasetCreationParameters'

    CreateControlledGcpAiNotebookInstanceRequestBody:
      description: Payload for requesting a new controlled GCS bucket resource.
      type: object
      properties:
        common:
          $ref: '#/components/schemas/ControlledResourceCommonFields'
        aiNotebookInstance:
          $ref: '#/components/schemas/GcpAiNotebookInstanceCreationParameters'
        jobControl:
          $ref: '#/components/schemas/JobControl'

    ControlledResourceCommonFields:
      type: object
      required: [ name, cloningInstructions, accessScope, managedBy ]
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        accessScope:
          $ref: '#/components/schemas/AccessScope'
        managedBy:
          $ref: '#/components/schemas/ManagedBy'
        privateResourceUser:
          $ref: '#/components/schemas/PrivateResourceUser'

    PrivateResourceUser:
      description: User and role information for a user of a private resource.
      type: object
      properties:
        userName:
          description: Email address for the user of the resource
          type: string
        privateResourceIamRoles:
          $ref: '#/components/schemas/PrivateResourceIamRoles'

    PrivateResourceIamRoles:
      description: >-
        List of role(s) granted to the user of a private resource. WRITER includes
        READER by definition, so if both are present only WRITER will be granted.
      type: array
      items:
        $ref: '#/components/schemas/ControlledResourceIamRole'

    ReferenceResourceCommonFields:
      type: object
      required: [name, cloningInstructions]
      description: Common information used in all reference requests
      properties:
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'

    UpdateControlledResourceRequestBody:
      type: object
      description: Common request body for updating a controlled resource
      properties:
        name:
          description: Optional. New name to give to this resource. The resource name will not be updated if this is omitted.
          type: string
        description:
          description: Optional. New description to give to this resource. The resource description will not be updated if this is omitted.
          type: string
    UpdateControlledGcpGcsBucketRequestBody:
      type: object
      description: Update a GCS bucket's metadata and lifecycle rules.
      properties:
        name:
          description: Optional. New name to give to this resource. The resource name will not be updated if this is omitted.
          type: string
        description:
          description: Optional. New description to give to this resource. The resource description will not be updated if this is omitted.
          type: string
        updateParameters:
          $ref: '#/components/schemas/GcpGcsBucketUpdateParameters'
    UpdateControlledGcpBigQueryDatasetRequestBody:
      type: object
      description: Update a BigQuery dataset's metadata and expiration times.
      properties:
        name:
          description: Optional. New name to give to this resource. The resource name will not be updated if this is omitted.
          type: string
        description:
          description: Optional. New description to give to this resource. The resource description will not be updated if this is omitted.
          type: string
        updateParameters:
          $ref: '#/components/schemas/GcpBigQueryDatasetUpdateParameters'
    CreatedControlledGcpGcsBucket:
      description: Response Payload for requesting a new controlled GCS bucket.
      type: object
      properties:
        resourceId:
          description: UUID of a newly-created resource. Null if not created yet.
          type: string
          format: uuid
        gcpBucket:
          $ref: '#/components/schemas/GcpGcsBucketResource'
    CreatedControlledGcpBigQueryDataset:
      description: Response Payload for requesting a new controlled BigQuery dataset.
      type: object
      properties:
        resourceId:
          description: UUID of a newly-created resource. Null if not created yet.
          type: string
          format: uuid
        bigQueryDataset:
          $ref: '#/components/schemas/GcpBigQueryDatasetResource'

    GcpGcsBucketCreationParameters:
      description: >-
        Bucket-specific properties to be set on creation. These are a subset of the
        values accepted by the Gcp Storage API.
      type: object
      required: [name, location]
      properties:
        name:
          description: A valid bucket name per https://cloud.google.com/storage/docs/naming-buckets.
          type: string
        location:
          description: A valid bucket location per https://cloud.google.com/storage/docs/locations.
          type: string
        defaultStorageClass:
          $ref: '#/components/schemas/GcpGcsBucketDefaultStorageClass'
        lifecycle:
          $ref: '#/components/schemas/GcpGcsBucketLifecycle'

    GcpGcsBucketUpdateParameters:
      description: >-
        Parameters that may be changed by a user. Location and Bucket name are fixed upon create.
      properties:
        defaultStorageClass:
          $ref: '#/components/schemas/GcpGcsBucketDefaultStorageClass'
        lifecycle:
          $ref: '#/components/schemas/GcpGcsBucketLifecycle'

    GcpGcsBucketDefaultStorageClass:
      description: >-
        Type and availability of objects in a bucket, described at https://cloud.google.com/storage/docs/storage-classes.
        This list does not include legacy types that apply to some existing buckets.
      type: string
      enum:
        - STANDARD
        - NEARLINE
        - COLDLINE
        - ARCHIVE
    GcpGcsBucketLifecycle:
      description: >-
        Options to control automatic deletion or storage class change for a bucket.
        Described at https://cloud.google.com/storage/docs/lifecycle.
      type: object
      properties:
        rules:
          description: List of rules for this bucket
          type: array
          items:
            $ref: '#/components/schemas/GcpGcsBucketLifecycleRule'

    GcpGcsBucketLifecycleRule:
      description: A lifecycle rule for a bucket.
      type: object
      properties:
        action:
          $ref: '#/components/schemas/GcpGcsBucketLifecycleRuleAction'
        condition:
          $ref: '#/components/schemas/GcpGcsBucketLifecycleRuleCondition'

    GcpGcsBucketLifecycleRuleAction:
      description: The lifecycle action to take. See https://cloud.google.com/storage/docs/lifecycle#actions.
      type: object
      properties:
        storageClass:
          $ref: '#/components/schemas/GcpGcsBucketDefaultStorageClass'
        type:
          $ref: '#/components/schemas/GcpGcsBucketLifecycleRuleActionType'

    GcpGcsBucketLifecycleRuleActionType:
      description: >-
        Type of action to perform. Formatted like our Java enums, but spelled in Camel case in Gcp API.
      type: string
      enum:
        - DELETE
        - SET_STORAGE_CLASS

    GcpGcsBucketLifecycleRuleCondition:
      description: The condition(s) under which the action will be taken.
      type: object
      properties:
        age:
          description: Age of an object (in days). This condition is satisfied when an object reaches the specified age.
          type: integer
        createdBefore:
          description: This condition is satisfied when an object is created before midnight of the specified date in UTC.
          type: string
          format: date-time
        customTimeBefore:
          description: >-
            This condition is satisfied when the customTime metadata for the object is set to an
            earlier date than the date used in this lifecycle condition.
          type: string
          format: date-time
        daysSinceCustomTime:
          description: >-
            Days since the date set in the customTime metadata for the object. This condition is
            satisfied when the current date and time is at least the specified number of days after
            the customTime.
          type: integer
        daysSinceNoncurrentTime:
          description: >-
            Relevant only for versioned objects. This condition is satisfied when an object has
            been noncurrent for more than the specified number of days.
          type: integer
        live:
          description: >-
            Relevant only for versioned objects. If the value is true, this condition matches the
            live version of objects; if the value is false, it matches noncurrent versions of objects.
          type: boolean
        matchesStorageClass:
          description: >-
            Objects having any of the storage classes specified by this condition will be matched. 
            Values include "STANDARD", "NEARLINE", "COLDLINE", "ARCHIVE", "MULTI_REGIONAL",
            "REGIONAL", and "DURABLE_REDUCED_AVAILABILITY".
          type: array
          items:
            $ref: '#/components/schemas/GcpGcsBucketDefaultStorageClass'
        noncurrentTimeBefore:
          description: >-
            Relevant only for versioned objects. This condition is satisfied for objects that became
            noncurrent on a date prior to the one specified in this condition.
          type: string
          format: date-time
        numNewerVersions:
          description: >-
            Relevant only for versioned objects. If the value is N, this condition is satisfied
            when there are at least N versions (including the live version) newer than this version
            of the object.
          type: integer

    CloneControlledGcpGcsBucketRequest:
      description: >-
        Values to assign to the cloned bucket for a given source bucket. Leave
        name and description null to take the source object's values.
      type: object
      required: [destinationWorkspaceId, jobControl]
      properties:
        destinationWorkspaceId:
          description: ID of workspace to be cloned into
          type: string
          format: uuid
        cloningInstructions:
          $ref: "#/components/schemas/CloningInstructionsEnum"
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        bucketName:
          description: >-
            Name of created bucket (not the resource name). This name must
            be globally unique, so it can't be a copy of the original bucket name.
            It also can't be a simple formula like copy-of-bucket-name, as that would
            fail on subsequent clone operations with bucket-name as the source bucket.
            If null, a random bucket name will be created.
          type: string
        location:
          description: >-
            A valid bucket location per https://cloud.google.com/storage/docs/locations.
            If null, will use source bucket's location.
          type: string
        jobControl:
          $ref: '#/components/schemas/JobControl'
    ClonedControlledGcpGcsBucket:
      description: >-
        Response object for clone of a GCS Bucket. Destination workspace and
        resource IDs are available in the bucket's metadata object. TODO: generalize so there's a
        single response type for all resource clones?
      type: object
      properties:
        effectiveCloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        sourceWorkspaceId:
          description: ID of the workspace of the source resource for this clone
          type: string
          format: uuid
        sourceResourceId:
          description: ID of the source resource
          type: string
          format: uuid
        bucket:
          $ref: "#/components/schemas/CreatedControlledGcpGcsBucket"
    CloneControlledGcpGcsBucketResult:
      description: >-
        API result class for cloning a GCS bucket.
      type: object
      properties:
        bucket:
          $ref: '#/components/schemas/ClonedControlledGcpGcsBucket'
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'
    CloneReferencedGcpGcsBucketResourceResult:
      description: >-
        API result class for cloning a referenced GCS Bucket resource. Includes source workspace
        and resource IDs for provenance. If the effective cloning instructions are not
        COPY_REFERENCE, then no clone is created and the resource is null.
      type: object
      properties:
        effectiveCloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        sourceWorkspaceId:
          description: ID of the workspace of the source resource for this clone
          type: string
          format: uuid
        sourceResourceId:
          description: ID of the source resource
          type: string
          format: uuid
        resource:
          $ref: '#/components/schemas/GcpGcsBucketResource'
    CloneReferencedGcpBigQueryDatasetResourceResult:
      description: >-
        API result class for cloning a referenced BigQuery dataset resource. Includes source workspace
        and resource IDs for provenance. If the effective cloning instructions are not
        COPY_REFERENCE, then no clone is created and the resource is null.
      type: object
      properties:
        effectiveCloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        sourceWorkspaceId:
          description: ID of the workspace of the source resource for this clone
          type: string
          format: uuid
        sourceResourceId:
          description: ID of the source resource
          type: string
          format: uuid
        resource:
          $ref: '#/components/schemas/GcpBigQueryDatasetResource'
    CloneReferencedGcpDataRepoSnapshotResourceResult:
      description: >-
        API result class for cloning a referenced Data Repo snapshot resource. Includes source workspace
        and resource IDs for provenance. If the effective cloning instructions are not
        COPY_REFERENCE, then no clone is created and the resource is null.
      type: object
      properties:
        effectiveCloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        sourceWorkspaceId:
          description: ID of the workspace of the source resource for this clone
          type: string
          format: uuid
        sourceResourceId:
          description: ID of the source resource
          type: string
          format: uuid
        resource:
          $ref: '#/components/schemas/DataRepoSnapshotResource'
    GcpBigQueryDatasetCreationParameters:
      description: >-
        Dataset-specific properties to be set on creation. These are a subset of the
        values accepted by the BigQuery API.
      type: object
      properties:
        datasetId:
          description: A valid dataset name per https://cloud.google.com/bigquery/docs/datasets#dataset-naming
          type: string
          required: true
        location:
          description: A valid dataset location per https://cloud.google.com/bigquery/docs/locations.
          type: string
          required: true
        defaultTableLifetime:
          description: Optional. Default lifetime (in seconds) for newly created tables.
          type: integer
        defaultPartitionLifetime:
          description: Optional. Default lifetime (in seconds) for partitions in newly created partitioned tables.
          type: integer
    GcpBigQueryDatasetUpdateParameters:
      description: >-
        Parameters that may be changed by a user. Location and dataset id are fixed upon create.
      properties:
        defaultTableLifetime:
          description:  >-
            Optional. Default lifetime (in seconds) for newly created tables.
            Specify zero (0) to unset an existing value.
            The default table lifetime will not be updated if this is omitted.
          type: integer
        defaultPartitionLifetime:
          description:  >-
            Optional. Default lifetime (in seconds) for partitions in newly created partitioned tables.
            Specify zero (0) to unset an existing value.
            The default partition lifetime will not be updated if this is omitted.
          type: integer

    CloneControlledGcpBigQueryDatasetRequest:
      description: >-
        Values to assign to the cloned dataset for a given source dataset. Leave
        name and description null to take the source object's values.
      type: object
      required: [destinationWorkspaceId, jobControl]
      properties:
        destinationWorkspaceId:
          description: ID of workspace to be cloned into
          type: string
          format: uuid
        destinationDatasetName:
          description: Name for destination dataset. Letters, numbers and underscores only.
          type: string
        cloningInstructions:
          $ref: "#/components/schemas/CloningInstructionsEnum"
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        location:
          description: >-
            A valid dataset location per https://cloud.google.com/bigquery/docs/locations.
            If null, will use source dataset's location.
          type: string
        jobControl:
          $ref: '#/components/schemas/JobControl'
    CloneControlledGcpBigQueryDatasetResult:
      description: Result of successful BigQuery dataset clone
      type: object
      properties:
        dataset:
          $ref: '#/components/schemas/ClonedControlledGcpBigQueryDataset'
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'
    ClonedControlledGcpBigQueryDataset:
      description: >-
        Response object for clone of a BigQuery dataset. Destination workspace and
        resource IDs are available in the bucket's metadata object.
      type: object
      properties:
        effectiveCloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        sourceWorkspaceId:
          description: ID of the workspace of the source resource for this clone
          type: string
          format: uuid
        sourceResourceId:
          description: ID of the source resource
          type: string
          format: uuid
        dataset:
          $ref: "#/components/schemas/GcpBigQueryDatasetResource"
    CloneWorkspaceRequest:
      description: >-
        Request body for cloning an entire workspace. The stage is always MC. Cloning instructions
        are taken from individual resources.
      type: object
      required:
        - spendProfile
      properties:
        displayName:
          description: The human readable name of the workspace
          type: string
        description:
          description: A description of the cloned workspace
          type: string
        spendProfile:
          description: ID of provided spend profile
          type: string
        location:
          description: >-
            GCP Location to use for cloud-based resources. If omitted, the location of the source
            resource will be used.
          type: string
    CloneWorkspaceResult:
      description: >-
        Response for workspace clone, including details on each controlled or referenced resource
        either cloned or attempted to be cloned.
      type: object
      properties:
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'
        workspace:
          $ref: '#/components/schemas/ClonedWorkspace'
    ClonedWorkspace:
      description: >-
        Flight result class for workspace clone. Indicates status for each resource
        cloned (or skipped).
      type: object
      properties:
        sourceWorkspaceId:
          type: string
          format: uuid
        destinationWorkspaceId:
          type: string
          format: uuid
        resources:
          type: array
          items:
            $ref: '#/components/schemas/ResourceCloneDetails'
    ResourceCloneDetails:
      description: >-
        A structure to give provenance of a controlled or referenced resource clone
      type: object
      properties:
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        resourceType:
          $ref: '#/components/schemas/ResourceType'
        stewardshipType:
          $ref: '#/components/schemas/StewardshipType'
        sourceResourceId:
          description: resource ID of the original resource
          type: string
          format: uuid
        destinationResourceId:
          description: resource ID of the cloned resource, or null if failed or skipped
          type: string
          format: uuid
        result:
          $ref: '#/components/schemas/CloneResourceResult'
        errorMessage:
          description: If result is FAILED, a short description of the cause, if available.
          type: string
        name:
          description: name of the resource (same as source)
          type: string
        description:
          description:  description of the destination resource (same as source)
          type: string
    CloneResourceResult:
      type: string
      enum:
        - SUCCEEDED
        - FAILED
        - SKIPPED
    DeleteControlledGcpGcsBucketRequest:
      type: object
      required: [ jobControl ]
      properties:
        jobControl:
          $ref: '#/components/schemas/JobControl'

    DeleteControlledGcpGcsBucketResult:
      type: object
      properties:
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'

    CreatedControlledGcpAiNotebookInstanceResult:
      type: object
      properties:
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'
        aiNotebookInstance:
          $ref: '#/components/schemas/GcpAiNotebookInstanceResource'

    GcpAiNotebookInstanceCreationParameters:
      description: >-
        AI Platform Notebook instance specific properties to be set on creation. These are a subset of the
        values accepted by the GCP AI Platforms API. See https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/projects.locations.instances/create
      type: object
      properties:
        instanceId:
          description: >-
            An instanceId unique to this project and location. Must be 1-63 characters, using lower
            case letters, numbers, and dashes. The first character must be a lower case letter,
            and the last character must not be a dash.
          type: string
          required: true
        location:
          description: The canonical GCP id for this location. For example, \'us-east1\'.
          type: string
          required: true
        postStartupScript:
          description: >-
            Path to a Bash script that automatically runs after a notebook instance fully boots up.
            The path must be a URL or Cloud Storage path (gs://path-to-file/file-name). If the path
            is a cloud storage path, the created VM instance's service account's credentials is used
            to access it.
          type: string
        machineType:
          description: The Compute Engine machine type of this instance, see
            https://cloud.google.com/compute/docs/machine-types
          type: string
          required: true
        acceleratorConfig:
          $ref: '#/components/schemas/GcpAiNotebookInstanceAcceleratorConfig'
        installGpuDriver:
          description: >-
            Whether the end user authorizes Google Cloud to install GPU driver on this instance. If
            this field is empty or set to false, the GPU driver won't be installed. Only applicable
            to instances with GPUs.
          type: boolean
        customGpuDriverPath:
          description: >-
            Specify a custom Cloud Storage path where the GPU driver is stored. If not specified,
            we'll automatically choose from official GPU drivers.
          type: string
        bootDiskType:
          description: >-
            The type of the boot disk attached to this instance, defaults to standard persistent
            disk (PD_STANDARD). See https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/projects.locations.instances#DiskType
          type: string
        bootDiskSizeGb:
          description: >-
            Input only. The size of the boot disk in GB attached to this instance, up to a maximum
            of 64000 GB (64 TB). The minimum recommended value is 100 GB. If not specified, this
            defaults to 100.
          type: integer
          format: int64
        dataDiskType:
          description: >-
            Input only. The type of the data disk attached to this instance, defaults to standard
            persistent disk (PD_STANDARD). See https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/projects.locations.instances#DiskType
          type: string
        dataDiskSizeGb:
          description: >-
            Input only. The size of the data disk in GB attached to this instance, up to a maximum
            of 64000 GB (64 TB). If not specified, this defaults to 100.
          type: integer
          format: int64
        metadata:
          description: >-
            Custom metadata to apply to this instance. Some metadata keys are reserved by Terra and
            will throw a bad request error if specified: 'proxy-mode'.
          type: object
          additionalProperties:
            type: string
        vmImage:
          $ref: '#/components/schemas/GcpAiNotebookInstanceVmImage'
        containerImage:
          $ref: '#/components/schemas/GcpAiNotebookInstanceContainerImage'

    GcpAiNotebookInstanceAcceleratorConfig:
      description: >-
        The hardware accelerator used on this instance. If you use accelerators, make sure that your
        configuration has enough vCPUs and memory to support the machineType you have selected.
        See https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/projects.locations.instances#AcceleratorConfig
      type: object
      properties:
        type:
          description: Type of this accelerator
          type: string
        coreCount:
          description: Count of cores of this accelerator.
          type: integer
          format: int64

    GcpAiNotebookInstanceVmImage:
      description: >-
        Either this or containerImage must be specified. Definition of a custom Compute Engine
        virtual machine image for starting a notebook instance with the environment installed
        directly on the VM. See
        https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/VmImage
      type: object
      properties:
        projectId:
          description: >-
            The name of the Google Cloud project that this VM image belongs to. Format:
            'projects/{project_id}'
          type: string
          required: true
        imageName:
          description: >-
            Either this or imageFamily must be specified. Use VM image name to find the image.
          type: string
        imageFamily:
          description: >-
            Either this or imageName must be specified. Use this VM image family to find the image;
            the newest image in this family will be used.
          type: string

    GcpAiNotebookInstanceContainerImage:
      description: >-
        Either this or vmImage must be specified. Definition of a container image for starting a
        notebook instance with the environment installed in a container. See
        https://cloud.google.com/ai-platform/notebooks/docs/reference/rest/v1/ContainerImage
      type: object
      properties:
        repository:
          description: >-
            Required. The path to the container image repository. For example:
            'gcr.io/{project_id}/{imageName}'
          type: string
          required: true
        tag:
          description: >-
            The tag of the container image. If not specified, this defaults to the latest tag.
          type: string

    DeleteControlledGcpAiNotebookInstanceRequest:
      type: object
      required: [ jobControl ]
      properties:
        jobControl:
          $ref: '#/components/schemas/JobControl'

    DeleteControlledGcpAiNotebookInstanceResult:
      type: object
      properties:
        jobReport:
          $ref: '#/components/schemas/JobReport'
        errorReport:
          $ref: '#/components/schemas/ErrorReport'

    ## Cloud Resource, Attribute, and Enumeration structures ##
    ## Resources and attributes are in alphabetical order
    ## followed by enumerations in alphabetical order.

    ControlledResourceMetadata:
      type: object
      properties:
        accessScope:
          $ref: '#/components/schemas/AccessScope'
        managedBy:
          $ref: '#/components/schemas/ManagedBy'
        privateResourceUser:
          $ref: '#/components/schemas/PrivateResourceUser'

    DataRepoSnapshotAttributes:
      description: Attributes of a data repository snapshot
      type: object
      required: [instanceName, snapshot]
      properties:
        instanceName:
          description: The name of the Data Repo instance
          type: string
        snapshot:
          description: The ID of the Data Repo snapshot
          type: string

    DataRepoSnapshotResource:
      deprecated: true
      type: object
      description: A Data Repo snapshot resource
      required: [metadata, snapshot]
      properties:
        metadata:
          description: the resource metadata common to all resources
          $ref: '#/components/schemas/ResourceMetadata'
        attributes:
          $ref: '#/components/schemas/DataRepoSnapshotAttributes'

    GcpBigQueryDatasetAttributes:
      description: Attributes of a BigQuery dataset
      type: object
      required: [projectId, datasetId]
      properties:
        projectId:
          type: string
        datasetId:
          type: string

    GcpBigQueryDatasetResource:
      type: object
      description: A reference to a BigQuery dataset.
      required: [metadata, dataset]
      properties:
        metadata:
          description: the resource metadata common to all resources
          $ref: '#/components/schemas/ResourceMetadata'
        attributes:
          $ref: '#/components/schemas/GcpBigQueryDatasetAttributes'

    GcpGcsBucketAttributes:
      description: >-
        Bucket properties included in post-creation, get, and update. Others must be
        retrieved from GCS using the name.
      type: object
      properties:
        bucketName:
          description: Name of created bucket (not the resource name).
          type: string

    GcpGcsBucketResource:
      type: object
      description: Description of a GCS bucket.
      required: [metadata, attributes]
      properties:
        metadata:
          description: the resource metadata common to all resources
          $ref: '#/components/schemas/ResourceMetadata'
        attributes:
          $ref: '#/components/schemas/GcpGcsBucketAttributes'

    GcpAiNotebookInstanceAttributes:
      description: >-
        AI Notebook instance properties included in post-creation, get, and update. Others must be
        retrieved from GCP using the specification.
      type: object
      properties:
        projectId:
          description: The GCP project id for the project containing the notebook instance.
          type: string
        location:
          description: The GCP location containing the notebook instance, e.g. 'us-east1-b'
          type: string
        instanceId:
          description: An instance id unique to this project and location.
          type: string

    GcpAiNotebookInstanceResource:
      type: object
      description: Description of a AI Notebook Instance resource.
      required: [metadata, attributes]
      properties:
        metadata:
          description: the resource metadata common to all resources
          $ref: '#/components/schemas/ResourceMetadata'
        attributes:
          $ref: '#/components/schemas/GcpAiNotebookInstanceAttributes'

    ResourceAttributesUnion:
      type: object
      description: |
        This object contains a reference to an object for each resource type.
        Exactly one will be populated based on the ResourceType in the
        ResourceDescription. The value of the other references is undefined.
      properties:
        gcpBqDataset:
          $ref: '#/components/schemas/GcpBigQueryDatasetAttributes'
        gcpDataRepoSnapshot:
          $ref: '#/components/schemas/DataRepoSnapshotAttributes'
        gcpGcsBucket:
          $ref: '#/components/schemas/GcpGcsBucketAttributes'
        gcpAiNotebookInstance:
          $ref: '#/components/schemas/GcpAiNotebookInstanceAttributes'

    ResourceDescription:
      type: object
      properties:
        metadata:
          description: the resource metadata common to all resources
          $ref: '#/components/schemas/ResourceMetadata'
        resourceAttributes:
          description: Data specific to the type of resource and whether it is controlled or not
          $ref: '#/components/schemas/ResourceAttributesUnion'

    ResourceList:
      type: object
      required: [resources]
      properties:
        resources:
          description: Enumerated list of controlled and referenced resources
          type: array
          items:
            $ref: '#/components/schemas/ResourceDescription'

    ResourceMetadata:
      type: object
      properties:
        workspaceId:
          type: string
          format: uuid
        resourceId:
          type: string
          format: uuid
        name:
          $ref: "#/components/schemas/Name"
        description:
          type: string
        resourceType:
          $ref: '#/components/schemas/ResourceType'
        stewardshipType:
          $ref: '#/components/schemas/StewardshipType'
        cloudPlatform:
          $ref: '#/components/schemas/CloudPlatform'
        cloningInstructions:
          $ref: '#/components/schemas/CloningInstructionsEnum'
        controlledResourceMetadata:
          description: Present if stewardship type is CONTROLLED
          $ref: '#/components/schemas/ControlledResourceMetadata'

    PetServiceAccount:
      description: The email identifier of a pet service account
      type: string

    # Enumerations (related to resources) in alphabetical order.
    AccessScope:
      type: string
      description: Specifies the resource as shared or private
      enum: ['SHARED_ACCESS', 'PRIVATE_ACCESS']

    CloudPlatform:
      type: string
      description: Enum representing a cloud platform type.
      enum: ['GCP']

    CloningInstructionsEnum:
      type: string
      description: Instructions for copying this reference when cloning the workspace
      enum: ['COPY_NOTHING', 'COPY_DEFINITION', 'COPY_RESOURCE', 'COPY_REFERENCE']

    ManagedBy:
      type: string
      description: Specifies the controller of the resource, workspace users or an application
      enum: [ 'USER', 'APPLICATION' ]

    # The resource types are common to both stewardship types
    ResourceType:
      description: Enum containing valid resource types. Used for enumeration
      type: string
      enum:
        - AI_NOTEBOOK
        - BIG_QUERY_DATASET
        - DATA_REPO_SNAPSHOT
        - GCS_BUCKET

    StewardshipType:
      description: Enum containing valid stewardship types. Used for enumeration
      type: string
      enum: ['REFERENCED', 'CONTROLLED']

  responses:
    ### DEPRECATED RESPONSES ###
    # TODO(PF-404): remove this in favor of reference-type specific objects.
    DataReferenceResponse:
      description: Response to getDataReference calls
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DataReferenceDescription'

    # TODO(PF-404): remove this in favor of reference-type specific objects.
    ReferenceListResponse:
      description: Response to list resource calls
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DataReferenceList'
    ### END OF DEPRECATED RESPONSES ###

    EnablePetSaResponse:
      description: Response to enablePet calls
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/PetServiceAccount'

    CreatedWorkspaceResponse:
      description: Response to createWorkspace calls
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreatedWorkspace'

    DataRepoSnapshotReferenceResponse:
      description: Response containing a reference to a Data Repo snapshot.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DataRepoSnapshotResource'

    GcpGcsBucketReferenceResponse:
      description: Response containing a reference to a Gcp bucket.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpGcsBucketResource'

    GcpBigQueryDatasetReferenceResponse:
      description: Response containing a reference to a BiqQuery dataset.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpBigQueryDatasetResource'

    RoleBindingListResponse:
      description: Response to list permissions calls
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/RoleBindingList'

    CreatedControlledGcpGcsBucketResponse:
      description: Response to Create controlled Gcs bucket
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreatedControlledGcpGcsBucket'

    ClonedControlledGcpGcsBucketResponse:
      description: Response to GCS bucket clone operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneControlledGcpGcsBucketResult'

    DeleteControlledGcpGcsBucketResponse:
      description: Response Payload for deleting a Gcs bucket
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DeleteControlledGcpGcsBucketResult'

    GetControlledGcpGcsBucketResponse:
      description: Response to get bucket
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpGcsBucketResource'
    UpdateControlledGcpGcsBucketResponse:
      description: Reponse to GCP GCS Bucket update.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpGcsBucketResource' # TODO:  add other attributes
    CreatedControlledGcpBigQueryDatasetResponse:
      description: Response to Create controlled BigQuery dataset
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreatedControlledGcpBigQueryDataset'

    ControlledGcpBigQueryDatasetResponse:
      description: Response containing a controlled BigQuery dataset
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpBigQueryDatasetResource'

    CreatedControlledGcpAiNotebookInstanceResponse:
      description: Response to Create controlled resource
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreatedControlledGcpAiNotebookInstanceResult'

    DeleteControlledGcpAiNotebookInstanceResponse:
      description: Response Payload for deleting a Gcs bucket
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/DeleteControlledGcpAiNotebookInstanceResult'

    GetControlledGcpAiNotebookInstanceResponse:
      description: Response to get AI Notebook instance.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/GcpAiNotebookInstanceResource'

    CreateCloudContextResultResponse:
      description: Job is complete (succeeded or failed)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CreateCloudContextResult'
    CloneReferencedGcpGcsBucketResourceResponse:
      description: Response for successful GCS Bucket reference clone
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneReferencedGcpGcsBucketResourceResult'
    CloneReferencedGcpBigQueryDatasetResourceResponse:
      description: Response for successful BigQuery dataset reference clone
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneReferencedGcpBigQueryDatasetResourceResult'
    CloneReferencedGcpDataRepoSnapshotResourceResponse:
      description: Response for successful Data Repo Snapshot reference clone
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneReferencedGcpDataRepoSnapshotResourceResult'
    JobReportResponse:
      description: A response containing a JobReport object. Returned for running jobs.
      headers:
        Retry-After:
          description: >-
            optional - estimated seconds to wait before polling again. This allows
            a server to offer a hint as to when the job might be complete.
          schema:
            type: integer
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/JobReport'

    EnumerateResourcesResponse:
      description: Listing of resources
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ResourceList'

    CheckReferenceAccessResponse:
      description: Whether the specified reference is accessible or not
      content:
        application/json:
          schema:
            type: boolean
    CloneControlledGcpBigQueryDatasetResponse:
      description: response to clone BigQuery dataset operation.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneControlledGcpBigQueryDatasetResult'
    CloneWorkspaceResponse:
      description: Response to clone workspace request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/CloneWorkspaceResult'
    # Error Responses
    BadRequest:
      description: Bad request
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorReport'
    PermissionDenied:
      description: Permission denied
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorReport'
    NotFound:
      description: Not found (or unauthorized)
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorReport'
    Conflict:
      description: Request conflicts with current state
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorReport'
    ServerError:
      description: Server error
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorReport'

  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
    authorization:
      type: oauth2
      flows:
        implicit:
          authorizationUrl: https://accounts.google.com/o/oauth2/auth
          scopes:
            openid: open id authorization
            email: email authorization
            profile: profile authorization
    ## for AzurePoC - we do not do authn. Just accept the user email and objectId as user/pwd
    basicAuth:
      type: http
      scheme: basic

security:
  - bearerAuth: []
  - authorization: [openid, email, profile]
  - basicAuth: []
