# PF-1359
databaseChangeLog:
- changeSet:
    id: add workspace user_facing_id
    author: melchang
    changes:
    - addColumn:
        tableName: workspace
        columns:
          - column:
              name: user_facing_id
              type: text
              constraints:
                unique: true
              remarks: |
                A later changeset will add not null constraint (PF-1583).
    - sql:
        # user_facing_id is a required field. For new workspaces, UI/CLI will
        # require it. For existing workspaces, backfill with workspace_id.
        sql: update workspace set user_facing_id = workspace_id;
    - sql:
        # display_name is a required field. For new workspaces, UI/CLI will
        # require it. For existing workspaces, backfill with workspace_id.
        sql: update workspace set display_name = workspace_id where display_name is null or display_name = '';
