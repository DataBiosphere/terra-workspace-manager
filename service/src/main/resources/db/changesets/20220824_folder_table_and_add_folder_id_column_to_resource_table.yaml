databaseChangeLog:
- changeSet:
    id: add folder table
    author: yuhuyoyo
    changes:
    - createTable:
        tableName: folder
        remarks: |
          A table for folders in a workspace.
        columns:
        - column:
            name: workspace_id
            type: text
            constraints:
                nullable: false
                references: workspace(workspace_id)
                foreignKeyName: fk_folder_wid
                deleteCascade: true
            remarks: The UUID of the workspace
        - column:
            name: id
            type: text
            constraints:
              nullable: false
              primaryKey: true
        - column:
            name: display_name
            type: text
        - column:
            name: description
            type: text
        - column:
            name: parent_folder_id
            type: text
            constraints:
                nullable: true
                references: folder(id)
                foreignKeyName: fk_folder_id
                deleteCascade: true
    - addUniqueConstraint:
        tableName: folder
        # display name must be unique at the same folder level.
        columnNames: display_name, parent_folder_id, workspace_id
    - createTable:
        tableName: folder_and_resource
        remarks: |
            a table to store the relation between folder and resource. A folder
            can have multiple resources. A resource can belong to multiple
            folders.
        columns:
        - column:
              name: folder_id
              type: text
              constraints:
                  nullable: false
                  references: folder(id)
                  foreignKeyName: fk_folder_id
                  deleteCascade: true
        - column:
              name: resource_id
              type: text
              constraints:
                  nullable: false
                  references: resource(resource_id)
                  foreignKeyName: fk_resource_rid
                  deleteCascade: true

        - addUniqueConstraint:
              tableName: folder_and_resourc
              columnNames: folder_id, resource_id