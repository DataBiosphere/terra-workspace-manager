// Testing config

// The path to the default Google service account for the Workspace Manager to run as.
// Created by scripts/write_config.sh
def googleCredentialsFile = "${rootDir}/config/wsm-sa.json"
bootRun {
  environment.put("GOOGLE_APPLICATION_CREDENTIALS", "${googleCredentialsFile}")
}

tasks.withType(Test).configureEach {
  environment.put("GOOGLE_APPLICATION_CREDENTIALS", "${googleCredentialsFile}")
  systemProperty 'spring.profiles.include', 'human-readable-logging'
  testLogging {
    if (System.getenv('PRINT_STANDARD_STREAMS') == null) {
      events = ["passed", "failed", "skipped", "started"]
    } else {
      events = ["passed", "failed", "skipped", "started", "standard_out", "standard_error"]
    }
  }
}

test {
  useJUnitPlatform {
    includeTags "unit"
  }
  outputs.upToDateWhen { false }
  finalizedBy tasks.combinedJaCoCoReport
}

task unitTest(type: Test) {
  useJUnitPlatform {
    includeTags "unit"
  }
  outputs.upToDateWhen { false }
  finalizedBy tasks.combinedJaCoCoReport
}

task connectedTest(type: Test) {
  environment.put('TEST_ENV', System.getenv("TEST_ENV"))
  useJUnitPlatform {
    includeTags "connected"
  }
  outputs.upToDateWhen { false }
  finalizedBy tasks.combinedJaCoCoReport
}

task azureTest(type: Test) {
  useJUnitPlatform {
    includeTags "azure"
  }
  outputs.upToDateWhen { false }
  finalizedBy tasks.combinedJaCoCoReport
}
